# Claude Code 作業方針

## 目的

このドキュメントは、Claude Code がこのリポジトリで作業する際の方針とプロジェクト固有ルールを示します。

## 判断記録のルール

すべての判断は、以下の形式で記録してください：

1. **判断内容の要約**: 何を決定したか
2. **検討した代替案**: どのような選択肢があったか
3. **採用しなかった案とその理由**: なぜ他の案を選ばなかったか
4. **前提条件・仮定・不確実性**: 判断の前提となる事実と仮定を明示
5. **他エージェントによるレビュー可否**: Codex CLI や Gemini CLI にレビューを依頼すべきか

**重要**: 前提・仮定・不確実性を明示し、仮定を事実のように扱わないでください。

## プロジェクト概要

このリポジトリは、[Zenn.dev](https://zenn.dev/book000) で公開する技術記事・書籍を管理するためのリポジトリです。

- **目的**: 日本語の技術記事・書籍の執筆・管理
- **プラットフォーム**: Zenn.dev
- **主な機能**: Markdown 形式での記事作成、textlint による品質管理、プレビューサーバーでの確認

## 重要ルール

### 言語ルール

- **会話言語**: 日本語
- **コード内コメント**: 日本語
- **エラーメッセージ**: 英語
- **日本語と英数字の間**: 半角スペースを挿入

### コミット・PR ルール

- **コミットメッセージ**: [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従う
  - 形式: `<type>(<scope>): <description>`
  - `<description>` は英語で記載（Conventional Commits 準拠）
  - 例: `docs(articles): add article about Docker setup`
- **ブランチ命名**: [Conventional Branch](https://conventional-branch.github.io) に従う
  - 形式: `<type>/<description>`
  - `<type>` は短縮形 (feat, fix, docs) を使用
  - 例: `docs/add-docker-article`

## 環境のルール

- **GitHub リポジトリ調査**: テンポラリディレクトリに `git clone` してコード検索
- **Renovate PR**: 既存の Renovate が作成したプルリクエストに対して、追加コミットや更新を行わない

## コード改修時のルール

- **日本語と英数字の間**: 半角スペースを挿入する
- **既存のエラーメッセージで絵文字がある場合**: 全体でエラーメッセージに絵文字を設定する。絵文字はエラーメッセージに即した一文字の絵文字である必要がある
- **docstring**: 関数やインターフェースには、docstring (JSDoc など) を日本語で記載・更新する

## 相談ルール

### Codex CLI (ask-codex)

以下の場合に Codex CLI に相談してください：

- 実装コードに対するソースコードレビュー
- 関数設計、モジュール内部の実装方針などの局所的な技術判断
- アーキテクチャ、モジュール間契約、パフォーマンス／セキュリティといった全体影響の判断
- 実装の正当性確認、機械的ミスの検出、既存コードとの整合性確認

### Gemini CLI (ask-gemini)

以下の場合に Gemini CLI に相談してください：

- SaaS 仕様、言語・ランタイムのバージョン差、料金・制限・クォータといった、最新の適切な情報が必要な外部依存の判断
- 外部一次情報の確認、最新仕様の調査、外部前提条件の検証

### 指摘への対応ルール

他エージェントが指摘・異議を提示した場合、以下のいずれかを行ってください。**黙殺・無言での不採用は禁止**します。

- 指摘を受け入れ、判断を修正する
- 指摘を退け、その理由を明示する

また、以下を必ず実施してください：

- 他エージェントの提案を鵜呑みにせず、その根拠や理由を理解する
- 自身の分析結果と他エージェントの意見が異なる場合は、双方の視点を比較検討する
- 最終的な判断は、両者の意見を総合的に評価した上で、自身で下す

## 開発コマンド

### 依存関係のインストール

```bash
pnpm install
```

### 開発サーバーの起動

```bash
pnpm run dev
# http://localhost:8000 でプレビュー可能
```

### 文章校正

```bash
# textlint 実行
pnpm run lint

# 自動修正可能な問題を修正
pnpm run fix
```

**重要**: `pnpm run fix` によって自動修正されたことにより、文章として不成立な状態・意味不明な文章になっていないかはよく確認してください。特に、"。" に置き換わるルールがあるため、これによって違和感のある文章となっていないかを確認してください。例えば「例」が「例。」のように末尾に句点が自動付与されることがありますが、この場合は「以下は例。」のように文として成立する形に修正する必要があります。

## アーキテクチャと主要ファイル

### ディレクトリ構造

```text
.
├── articles/           # 技術記事（Markdown ファイル）
├── books/             # 書籍コンテンツ
├── .textlint/         # textlint カスタムルール
├── .textlintrc        # textlint 設定（170+ ルール）
└── .markdownlint.jsonc # markdownlint 設定（120+ ルール）
```

### 技術スタック

- **言語**: Markdown（日本語）、Node.js
- **パッケージマネージャー**: pnpm v10.28.1
- **Node.js バージョン**: v24.13.0
- **主要ツール**: zenn-cli v0.4.0、textlint v15.5.1

## 実装パターン

### 推奨パターン

#### 記事メタデータ

各記事の先頭に以下のメタデータを記載してください：

```yaml
---
title: "記事タイトル"
emoji: "📝"
type: "tech"           # tech / idea
topics: ["javascript", "docker"]
published: true        # true / false
---
```

- `title`: 日本語で、記事の内容をわかりやすく端的に説明
- `emoji`: 記事の内容に則し、1 文字の絵文字で表現
- `type`: `tech` (技術記事) または `idea` (概念・キャリア記事)
- `topics`: 記事の内容に則し、関連するトピックを配列形式で記載
- `published`: 原則 `true` とする

#### Zenn 独自記法

```markdown
# 画像サイズ指定
![alt text](URL =250x)

# 画像キャプション
![](URL)
*キャプション*

# ファイル名付きコードブロック
```js:filename.js
const code = "example";
```

# Diff 構文
```diff js:file.js
+ 追加行
- 削除行
```

# メッセージボックス
:::message
通常のメッセージ
:::

:::message alert
警告メッセージ
:::

# アコーディオン
:::details タイトル
折りたたみ内容
:::

# 外部コンテンツ埋め込み
@[card](URL)           # リンクカード
@[tweet](URL)          # ツイート
@[youtube](ID)         # YouTube
@[gist](URL)           # Gist
```

### 非推奨パターン

- npm や yarn の使用（必ず pnpm を使用）
- ファイル名に CamelCase や snake_case を使用（kebab-case のみ）
- HTML タグの使用（`<br>` 以外は禁止）
- コードブロックの言語指定なし（必ず言語を指定）

## テスト

### テスト方針

- **テストフレームワーク**: textlint、markdownlint
- **テストコマンド**: `pnpm run lint`
- **CI/CD**: GitHub Actions で自動実行

### テスト追加条件

新規記事作成時や記事更新時は、以下を必ず実施してください：

1. `pnpm run fix` で自動修正
2. `pnpm run lint` で品質チェック
3. 手動で文章の整合性を確認

## ドキュメント更新ルール

### 更新対象

- README.md
- .github/copilot-instructions.md
- CLAUDE.md (このファイル)
- AGENTS.md
- GEMINI.md

### 更新タイミング

- 技術スタックの変更時
- 開発コマンドの変更時
- プロジェクト要件の変更時

## 作業チェックリスト

### 新規改修時

以下を必ず確認してください：

1. プロジェクトについて詳細に探索し理解すること
2. 作業を行うブランチが適切であること。すでに PR を提出しクローズされたブランチでないこと
3. 最新のリモートブランチに基づいた新規ブランチであること
4. PR がクローズされ、不要となったブランチは削除されていること
5. プロジェクトで指定されたパッケージマネージャにより、依存パッケージをインストールしたこと

### コミット・プッシュ前

以下を必ず確認してください：

1. コミットメッセージが [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従っていること。ただし、`<description>` は日本語で記載する
2. コミット内容にセンシティブな情報が含まれていないこと
3. Lint / Format エラーが発生しないこと
4. 動作確認を行い、期待通り動作すること

### PR 作成前

以下を必ず確認してください：

1. プルリクエストの作成をユーザーから依頼されていること
2. コミット内容にセンシティブな情報が含まれていないこと
3. コンフリクトする恐れが無いこと

### PR 作成後

プルリクエストを作成したあとは、以下を必ず実施してください。PR 作成後のプッシュ時に毎回実施してください。時間がかかる処理が多いため、Task を使って並列実行してください。

1. コンフリクトが発生していないこと
2. PR 本文の内容は、ブランチの現在の状態を、今までのこの PR での更新履歴を含むことなく、最新の状態のみ、漏れなく日本語で記載されていること。この PR を見たユーザーが、最終的にどのような変更を含む PR なのかをわかりやすく、細かく記載されていること
3. `gh pr checks <PR ID> --watch` で GitHub Actions CI を待ち、その結果がエラーとなっていないこと。成功している場合でも、ログを確認し、誤って成功扱いになっていないこと。もし GitHub Actions が動作しない場合は、ローカルで CI と同等のテストを行い、CI が成功することを保証しなければなりません。
4. `request-review-copilot` コマンドが存在する場合、`request-review-copilot https://github.com/$OWNER/$REPO/pull/$PR_NUMBER` で GitHub Copilot へレビューを依頼すること。レビュー依頼は自動で行われる場合もあるし、制約により `request-review-copilot` を実行しても GitHub Copilot がレビューしないケースがある
5. 10 分以内に投稿される GitHub Copilot レビューへの対応を行うこと。対応したら、レビューコメントそれぞれに対して返信を行うこと。レビュアーに GitHub Copilot がアサインされていない場合はスキップして構わない
6. `/code-review:code-review` によるコードレビューを実施したこと。コードレビュー内容に対しては、**スコアが 50 以上の指摘事項** に対して対応してください (80 がボーダーラインではありません)

## リポジトリ固有

### パッケージマネージャー

- **必須**: pnpm v10.28.1
- npm や yarn は使用しない
- 誤って別のパッケージマネージャーを使用した場合、生成されたロックファイルを削除すること

### Node.js バージョン

- **必須**: v24.13.0（`.node-version` で指定）
- Dev Container では自動的にこのバージョンが使用される

### テキスト処理ワークフロー

1. Markdown ファイルを編集
2. `pnpm run fix` で自動修正
3. `pnpm run lint` で品質確認
4. **手動レビュー**: 自動修正で文章が壊れていないか確認

### 文章品質基準

- **スタイル**: ですます調（丁寧・フォーマル）
- **句読点**: 「、」（カンマ）と 「。」（ピリオド）を使用
- **文法チェック**: い抜き言葉、サ抜き、フィラー（ええと、あの、など）を禁止
- **用語**: 技術用語の表記統一（例: "Cloudflare" not "CloudFlare"）
- **漢字 / ひらがな**: 特定の単語は平仮名を優先（副詞、代名詞など）

### ファイル命名規則

- 記事ファイル: `kebab-case.md`（全て小文字、ハイフン区切り）
- スペース、CamelCase、アンダースコアは禁止
- フロントマターの絵文字は 1 文字のみ

### コンテンツ品質ゲート

- すべての記事はコミット前に `pnpm run lint` を通過すること
- TODO コメントは禁止
- 日付と曜日のペアは一致すること
- HTML タグは `<br>` 以外禁止
- すべてのコードブロックには言語指定が必要

## 参考リンク

- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
- [Conventional Branch](https://conventional-branch.github.io)
- [Zenn CLI ガイド](https://zenn.dev/zenn/articles/zenn-cli-guide)
- [Zenn Markdown ガイド](https://zenn.dev/zenn/articles/markdown-guide)
- [textlint](https://textlint.github.io/)
